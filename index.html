<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart LED Controller - ESP32</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-hue: 160;
            --primary-sat: 100%;
            --primary-light: 50%;
            --background: #1a1a2e;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--background);
            color: white;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background 0.5s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            text-shadow: 0 0 10px hsla(var(--primary-hue), var(--primary-sat), var(--primary-light), 0.3);
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid hsla(var(--primary-hue), var(--primary-sat), var(--primary-light), 0.3);
        }

        .btn-primary {
            background: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            color: var(--background);
        }

        .effect-card:hover {
            border-color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
        }

        .dynamic-bg {
            animation: colorPulse 10s infinite alternate;
        }

        @keyframes colorPulse {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .rainbow-effect {
            background: linear-gradient(45deg, 
                #ff0000, #ff8000, #ffff00, 
                #00ff00, #00ffff, #0000ff, 
                #8000ff, #ff0080);
            background-size: 400% 400%;
            animation: colorPulse 5s ease infinite;
        }
    </style>
</head>
<body>
    <!-- Même structure HTML que précédemment -->
    
    <script>
        let currentColor = '#00ff88';

        function updateInterfaceColor(color) {
            const {h, s, l} = hexToHSL(color);
            
            document.documentElement.style.setProperty('--primary-hue', h);
            document.documentElement.style.setProperty('--primary-sat', s);
            document.documentElement.style.setProperty('--primary-light', l);
            
            document.body.style.background = `radial-gradient(
                circle at 75% 25%,
                hsla(${h}, ${s}, ${l}, 0.15),
                ${getComputedStyle(document.body).backgroundColor}
            )`;
        }

        function hexToHSL(hex) {
            let r = parseInt(hex.slice(1, 3), 16)/255,
                g = parseInt(hex.slice(3, 5), 16)/255,
                b = parseInt(hex.slice(5, 7), 16)/255;

            let max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if(max === min) {
                h = s = 0;
            } else {
                let d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch(max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h *= 60;
            }

            return {
                h: Math.round(h),
                s: `${Math.round(s * 100)}%`,
                l: `${Math.round(l * 100)}%`
            };
        }

        async function sendColor() {
            currentColor = document.getElementById('colorPicker').value;
            updateInterfaceColor(currentColor);
            
            const {r, g, b} = hexToRGB(currentColor);
            try {
                await fetch(`/color?r=${r}&g=${g}&b=${b}&brightness=${brightness}`);
                showStatus(`Couleur appliquée: ${currentColor}`, 'success');
            } catch (error) {
                showStatus('Erreur de connexion', 'error');
            }
        }

        async function sendEffect(element) {
            const effect = element.dataset.effect;
            
            if(effect === 'rainbow') {
                document.body.classList.add('rainbow-effect');
            } else {
                document.body.classList.remove('rainbow-effect');
                updateInterfaceColor(currentColor);
            }
            
            // Reste du code d'envoi d'effet...
        }
    </script>
</body>
</html>
